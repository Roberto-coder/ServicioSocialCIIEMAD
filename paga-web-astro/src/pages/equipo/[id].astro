---
import Layout from "../../layouts/BaseLayout.astro";
import { personas } from "../../content/personas.js";
import { publicaciones } from "../../content/publicaciones.js";
import { ArrowLeft, Mail, GraduationCap, Users, Target, Linkedin, ExternalLink } from "lucide-astro";

export async function getStaticPaths() {
  return personas.map((persona) => ({
    params: { id: persona.id },
  }));
}
const { id } = Astro.params;
const persona = personas.find((p) => p.id === id);
const publicacionesPersona = persona && persona.publicaciones
  ? publicaciones.filter((pub) => pub.autores.includes(persona.publicaciones[0]))
  : [];

---
<Layout>
  {persona ? (
    <div class="max-w-4xl mx-auto px-4 pt-8">
      <a href="/sobre-nosotros" class="inline-flex items-center text-verde hover:text-guinda transition-colors mb-8">
        <ArrowLeft class="w-4 h-4 mr-2" />
        Volver al equipo
      </a>
    </div>
    <section class="max-w-4xl mx-auto px-4 pb-16">
      <div class="grid md:grid-cols-3 gap-8 mb-12">
        <div class="md:col-span-1">
          <div class="aspect-square rounded-xl overflow-hidden shadow-lg">
            <img src={persona.foto} alt={persona.nombre} class="w-full h-full object-cover" />
          </div>
        </div>
        <div class="md:col-span-2">
          <h1 class="text-4xl font-serif text-guinda mb-2">{persona.nombre}</h1>
          <p class="text-xl text-verde font-medium mb-4">{persona.titulo}</p>
          <div class="flex items-center mb-6">
            <Mail class="w-5 h-5 text-gray-500 mr-2" />
            <a href={`mailto:${persona.email}`} class="text-guinda hover:underline">{persona.email}</a>
          </div>
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
              <GraduationCap class="w-5 h-5 mr-2" />
              Líneas de Investigación
            </h3>
            <div class="flex flex-wrap gap-2">
              {persona.especialidades.map((esp) => (
                <span class="bg-verde/10 text-verde px-3 py-1 rounded-full text-sm font-medium">{esp}</span>
              ))}
            </div>
          </div>
        </div>
      </div>

      <div class="bg-gray-50 p-6 rounded-lg">
          <h3
            class="text-lg font-semibold text-gray-800 mb-3 flex items-center"
          >
            <Users class="w-5 h-5 mr-2" />
            Semblanza Profesional
          </h3>
          <p class="text-gray-700 leading-relaxed">
            {persona.semblanza}
          </p>
        </div>

        
        <!-- Enlaces académicos -->
        <div class="mt-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">Enlaces Académicos</h3>
            <div class="flex flex-wrap gap-4">
            {persona.enlaces?.map((enlace) => (
            <a
                href={enlace.url}
                class={`inline-flex items-center text-${enlace.color} hover:text-${enlace.color.replace('600','800')} transition-colors`}
                target="_blank"
                rel="noopener noreferrer"
            >
                <ExternalLink class="w-4 h-4 mr-2" />
                {enlace.tipo}
            </a>
            ))}
        </div>
    </div>
<br>
    <div class="bg-white border border-gray-200 rounded-xl p-8">
        <h3 class="text-2xl font-serif text-guinda mb-6 flex items-center">
            <Target class="w-6 h-6 mr-3" />
            Proyectos Destacados
        </h3>
        <div class="grid md:grid-cols-2 gap-6">
            {persona.proyectos?.map((proy) => (
            <div class={`border-l-4 border-${proy.color} pl-4`}>
                <h4 class="font-semibold text-gray-800 mb-2">{proy.titulo}</h4>
                <p class="text-gray-600 text-sm">{proy.descripcion}</p>
            </div>
            ))}
        </div>
    </div>   

      <!-- Mis publicaciones -->
      <div class="bg-white rounded-xl shadow-md p-6 mt-10 mb-10 max-w-3xl mx-auto w-full">
        <h3 class="text-2xl font-serif text-guinda mb-6 text-center">Mis publicaciones</h3>
        <ul class="space-y-6">
          {publicacionesPersona.length > 0 ? (
            publicacionesPersona.map((pub) => (
              <li class="border-l-4 border-verde pl-4 py-4 flex flex-col sm:flex-row sm:items-center gap-2 bg-gray-50 rounded-lg shadow hover:shadow-lg transition-all duration-300">
                <div class="flex-1">
                  <div class="flex gap-2 mb-1 flex-wrap">
                    <span class="bg-verde/90 text-white text-xs font-bold px-3 py-1 rounded-full shadow">{pub.tipo}</span>
                    <span class="bg-guinda/90 text-white text-xs font-bold px-2 py-0.5 rounded shadow">{pub.anio}</span>
                  </div>
                  <h4 class="text-lg font-bold text-gray-900 mb-1 leading-snug">{pub.titulo}</h4>
                  <p class="text-sm text-gray-700 mb-2">{pub.autores}</p>
                </div>
                {pub.enlace && pub.enlace !== "enlace proximamente" ? (
                  <a href={pub.enlace} class="ml-4 mt-2 bg-verde/90 text-white px-4 py-2 rounded-lg font-semibold shadow hover:bg-guinda transition-colors duration-200 self-center" target="_blank" rel="noopener noreferrer">Ver</a>
                ) : (
                  <span class="ml-4 mt-2 text-gray-400 italic self-center">Próximamente</span>
                )}
              </li>
            ))
          ) : (
            <li class="text-center text-gray-500 italic">No hay publicaciones registradas.</li>
          )}
        </ul>
      </div>
    </section>
  ) : (
    <div class="max-w-2xl mx-auto py-20 text-center">
      <h1 class="text-3xl font-serif text-guinda mb-4">Perfil no encontrado</h1>
      <p class="text-gray-600">La persona solicitada no existe en el registro.</p>
      <a href="/sobre-nosotros" class="inline-block mt-8 bg-verde text-white px-6 py-2 rounded-lg font-semibold shadow hover:bg-guinda transition-colors duration-200">Volver al equipo</a>
    </div>
  )}
</Layout>
