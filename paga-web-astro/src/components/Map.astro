---
const { lat = 22.7689, lng = -102.5833, zoom = 13, markerText = '' } = Astro.props;
---

<!-- Leaflet CSS (loaded from CDN) -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<div class="w-full h-96 rounded-xl overflow-hidden shadow-inner" data-lat={lat} data-lng={lng} data-zoom={zoom} data-marker={markerText}></div>

<script type="module">
  if (typeof window !== 'undefined') {
    (async () => {
      const container = document.querySelector('div[data-lat][data-lng]');
      if (!container) return;

      const lat = parseFloat(container.getAttribute('data-lat')) || 0;
      const lng = parseFloat(container.getAttribute('data-lng')) || 0;
      const zoom = parseInt(container.getAttribute('data-zoom')) || 13;
      const markerText = container.getAttribute('data-marker') || '';

      try {
        const Lmod = await import('https://unpkg.com/leaflet@1.9.4/dist/leaflet-src.esm.js');
        const L = Lmod && Lmod.default ? Lmod.default : Lmod;

        const map = L.map(container).setView([lat, lng], zoom);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19,
          attribution: '&copy; OpenStreetMap contributors',
        }).addTo(map);

        const marker = L.marker([lat, lng]).addTo(map);
        if (markerText) marker.bindPopup(markerText);
      } catch (err) {
        console.error('Leaflet failed to load', err);
      }
    })();
  }
</script>